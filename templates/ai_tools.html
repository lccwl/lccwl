{% extends "base.html" %}

{% block title %}AI工具 - AI网站优化器{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="h3 mb-3">
                <i data-feather="cpu"></i>
                AI智能工具
            </h1>
            <p class="text-muted">使用AI生成文本、图片、视频、音频和代码内容</p>
        </div>
    </div>

    <!-- AI工具选择器 -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i data-feather="wand-2"></i>
                        内容生成工具
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-2 mb-3">
                            <button class="btn btn-outline-primary w-100 tool-selector active" data-tool="text">
                                <i data-feather="edit-3" class="mb-2"></i>
                                <div>文本生成</div>
                            </button>
                        </div>
                        <div class="col-md-2 mb-3">
                            <button class="btn btn-outline-primary w-100 tool-selector" data-tool="image">
                                <i data-feather="image" class="mb-2"></i>
                                <div>图片生成</div>
                            </button>
                        </div>
                        <div class="col-md-2 mb-3">
                            <button class="btn btn-outline-primary w-100 tool-selector" data-tool="video">
                                <i data-feather="video" class="mb-2"></i>
                                <div>视频生成</div>
                            </button>
                        </div>
                        <div class="col-md-2 mb-3">
                            <button class="btn btn-outline-primary w-100 tool-selector" data-tool="audio">
                                <i data-feather="mic" class="mb-2"></i>
                                <div>音频合成</div>
                            </button>
                        </div>
                        <div class="col-md-2 mb-3">
                            <button class="btn btn-outline-primary w-100 tool-selector" data-tool="code">
                                <i data-feather="code" class="mb-2"></i>
                                <div>代码生成</div>
                            </button>
                        </div>
                        <div class="col-md-2 mb-3">
                            <button class="btn btn-outline-primary w-100 tool-selector" data-tool="batch">
                                <i data-feather="layers" class="mb-2"></i>
                                <div>批量处理</div>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 工具面板 -->
    <div class="row mb-4">
        <div class="col-lg-8 mb-3">
            <!-- 文本生成工具 -->
            <div class="card tool-panel" id="textTool">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i data-feather="edit-3"></i>
                        AI文本生成
                    </h5>
                </div>
                <div class="card-body">
                    <form id="textGenerationForm">
                        <div class="mb-3">
                            <label for="textPrompt" class="form-label">内容描述</label>
                            <textarea class="form-control" id="textPrompt" rows="4" placeholder="请描述您想要生成的内容，例如：写一篇关于AI技术发展的博客文章..."></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="textType" class="form-label">内容类型</label>
                                <select class="form-select" id="textType">
                                    <option value="article">文章</option>
                                    <option value="blog">博客</option>
                                    <option value="product_description">产品描述</option>
                                    <option value="social_media">社媒内容</option>
                                    <option value="email">邮件内容</option>
                                    <option value="seo_content">SEO优化内容</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="textLength" class="form-label">内容长度</label>
                                <select class="form-select" id="textLength">
                                    <option value="short">简短 (200-500字)</option>
                                    <option value="medium" selected>中等 (500-1000字)</option>
                                    <option value="long">详细 (1000-2000字)</option>
                                    <option value="very_long">深度 (2000+字)</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="textTone" class="form-label">语调风格</label>
                                <select class="form-select" id="textTone">
                                    <option value="professional">专业</option>
                                    <option value="casual">轻松</option>
                                    <option value="friendly">友好</option>
                                    <option value="formal">正式</option>
                                    <option value="creative">创意</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="textKeywords" class="form-label">关键词 (可选)</label>
                            <input type="text" class="form-control" id="textKeywords" placeholder="关键词1, 关键词2, 关键词3">
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i data-feather="play"></i> 生成内容
                        </button>
                    </form>
                </div>
            </div>

            <!-- 图片生成工具 -->
            <div class="card tool-panel" id="imageTool" style="display: none;">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i data-feather="image"></i>
                        AI图片生成
                    </h5>
                </div>
                <div class="card-body">
                    <form id="imageGenerationForm">
                        <div class="mb-3">
                            <label for="imagePrompt" class="form-label">图片描述</label>
                            <textarea class="form-control" id="imagePrompt" rows="3" placeholder="描述您想要的图片，例如：一个现代化的办公室，阳光透过窗户洒在桌上..."></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="imageStyle" class="form-label">图片风格</label>
                                <select class="form-select" id="imageStyle">
                                    <option value="realistic">写实</option>
                                    <option value="artistic">艺术</option>
                                    <option value="cartoon">卡通</option>
                                    <option value="abstract">抽象</option>
                                    <option value="professional">商务</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="imageSize" class="form-label">图片尺寸</label>
                                <select class="form-select" id="imageSize">
                                    <option value="512x512">正方形 (512x512)</option>
                                    <option value="1024x1024" selected>大正方形 (1024x1024)</option>
                                    <option value="1024x768">横版 (1024x768)</option>
                                    <option value="768x1024">竖版 (768x1024)</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="imageQuality" class="form-label">图片质量</label>
                                <select class="form-select" id="imageQuality">
                                    <option value="standard" selected>标准</option>
                                    <option value="hd">高清</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i data-feather="image"></i> 生成图片
                        </button>
                    </form>
                </div>
            </div>

            <!-- 视频生成工具 -->
            <div class="card tool-panel" id="videoTool" style="display: none;">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i data-feather="video"></i>
                        AI视频生成
                    </h5>
                </div>
                <div class="card-body">
                    <form id="videoGenerationForm">
                        <div class="mb-3">
                            <label for="videoPrompt" class="form-label">视频描述</label>
                            <textarea class="form-control" id="videoPrompt" rows="3" placeholder="描述您想要的视频内容，例如：一只猫咪在花园中玩耍..."></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="videoDuration" class="form-label">视频时长</label>
                                <select class="form-select" id="videoDuration">
                                    <option value="5">5秒</option>
                                    <option value="10" selected>10秒</option>
                                    <option value="15">15秒</option>
                                    <option value="30">30秒</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="videoResolution" class="form-label">分辨率</label>
                                <select class="form-select" id="videoResolution">
                                    <option value="512x512" selected>512x512</option>
                                    <option value="768x768">768x768</option>
                                </select>
                            </div>
                        </div>
                        <div class="alert alert-info">
                            <i data-feather="info"></i>
                            视频生成可能需要较长时间，请耐心等待。
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i data-feather="video"></i> 生成视频
                        </button>
                    </form>
                </div>
            </div>

            <!-- 音频合成工具 -->
            <div class="card tool-panel" id="audioTool" style="display: none;">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i data-feather="mic"></i>
                        AI音频合成
                    </h5>
                </div>
                <div class="card-body">
                    <form id="audioGenerationForm">
                        <div class="mb-3">
                            <label for="audioText" class="form-label">文本内容</label>
                            <textarea class="form-control" id="audioText" rows="4" placeholder="输入要转换为语音的文本内容..."></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="audioLanguage" class="form-label">语言</label>
                                <select class="form-select" id="audioLanguage">
                                    <option value="zh" selected>中文</option>
                                    <option value="en">English</option>
                                    <option value="ja">日本語</option>
                                    <option value="ko">한국어</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="audioVoice" class="form-label">声音类型</label>
                                <select class="form-select" id="audioVoice">
                                    <option value="default" selected>默认</option>
                                    <option value="male">男声</option>
                                    <option value="female">女声</option>
                                </select>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="audioSpeed" class="form-label">语速</label>
                                <select class="form-select" id="audioSpeed">
                                    <option value="0.8">慢速</option>
                                    <option value="1.0" selected>正常</option>
                                    <option value="1.2">快速</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i data-feather="mic"></i> 生成音频
                        </button>
                    </form>
                </div>
            </div>

            <!-- 代码生成工具 -->
            <div class="card tool-panel" id="codeTool" style="display: none;">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i data-feather="code"></i>
                        AI代码生成
                    </h5>
                </div>
                <div class="card-body">
                    <form id="codeGenerationForm">
                        <div class="mb-3">
                            <label for="codePrompt" class="form-label">功能描述</label>
                            <textarea class="form-control" id="codePrompt" rows="3" placeholder="描述您需要的代码功能，例如：创建一个WordPress短代码来显示最新文章..."></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="codeLanguage" class="form-label">编程语言</label>
                                <select class="form-select" id="codeLanguage">
                                    <option value="php" selected>PHP</option>
                                    <option value="javascript">JavaScript</option>
                                    <option value="css">CSS</option>
                                    <option value="html">HTML</option>
                                    <option value="python">Python</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="codeFramework" class="form-label">框架/平台</label>
                                <select class="form-select" id="codeFramework">
                                    <option value="wordpress" selected>WordPress</option>
                                    <option value="vanilla">原生代码</option>
                                    <option value="jquery">jQuery</option>
                                    <option value="react">React</option>
                                    <option value="vue">Vue.js</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <i data-feather="code"></i> 生成代码
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- 侧边栏 - 生成历史和设置 -->
        <div class="col-lg-4 mb-3">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i data-feather="clock"></i>
                        生成历史
                    </h5>
                </div>
                <div class="card-body">
                    {% if generations %}
                        <div class="generation-history">
                            {% for gen in generations[:5] %}
                            <div class="d-flex justify-content-between align-items-center mb-3 p-2 rounded" style="background: rgba(22, 93, 255, 0.05);">
                                <div class="flex-grow-1">
                                    <div class="d-flex align-items-center mb-1">
                                        <span class="badge me-2" style="background: var(--primary-color);">{{ gen.type }}</span>
                                        <span class="status-badge status-{{ 'success' if gen.status == 'completed' else 'warning' }}">
                                            {{ '完成' if gen.status == 'completed' else '进行中' }}
                                        </span>
                                    </div>
                                    <small class="text-muted">{{ gen.prompt[:50] }}{% if gen.prompt|length > 50 %}...{% endif %}</small>
                                    <div class="text-muted" style="font-size: 0.75rem;">{{ gen.timestamp.strftime('%m/%d %H:%M') }}</div>
                                </div>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-primary" onclick="viewGeneration({{ gen.id }})">
                                        <i data-feather="eye"></i>
                                    </button>
                                    <button class="btn btn-outline-success" onclick="useGeneration({{ gen.id }})">
                                        <i data-feather="copy"></i>
                                    </button>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-3">
                            <i data-feather="cpu" class="text-muted mb-2" style="width: 32px; height: 32px;"></i>
                            <p class="text-muted mb-0">暂无生成历史</p>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- API使用情况 -->
            <div class="card mt-3">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i data-feather="bar-chart-2"></i>
                        API使用情况
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <small>今日使用</small>
                            <small class="text-muted">45/1000</small>
                        </div>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar" style="width: 4.5%; background: var(--primary-color);"></div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <small>本月使用</small>
                            <small class="text-muted">1,250/10,000</small>
                        </div>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar" style="width: 12.5%; background: var(--secondary-color);"></div>
                        </div>
                    </div>
                    <div class="text-center">
                        <button class="btn btn-sm btn-outline-primary">
                            <i data-feather="settings"></i> 管理配额
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 生成结果显示区域 -->
    <div class="row" id="generationResults" style="display: none;">
        <div class="col-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i data-feather="check-circle"></i>
                        生成结果
                    </h5>
                    <div>
                        <button class="btn btn-sm btn-outline-primary" id="copyResult">
                            <i data-feather="copy"></i> 复制
                        </button>
                        <button class="btn btn-sm btn-outline-success" id="saveResult">
                            <i data-feather="save"></i> 保存
                        </button>
                        <button class="btn btn-sm btn-outline-secondary" id="regenerate">
                            <i data-feather="refresh-cw"></i> 重新生成
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div id="resultContent">
                        <!-- 生成的内容将在这里显示 -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 生成详情模态框 -->
<div class="modal fade" id="generationModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="background: var(--card-bg); border: 1px solid var(--border-color);">
            <div class="modal-header" style="border-bottom: 1px solid var(--border-color);">
                <h5 class="modal-title">生成详情</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" style="filter: invert(1);"></button>
            </div>
            <div class="modal-body" id="generationModalContent">
                <!-- 内容将在这里加载 -->
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// 工具切换
document.querySelectorAll('.tool-selector').forEach(button => {
    button.addEventListener('click', function() {
        // 移除所有活动状态
        document.querySelectorAll('.tool-selector').forEach(btn => btn.classList.remove('active'));
        document.querySelectorAll('.tool-panel').forEach(panel => panel.style.display = 'none');
        
        // 激活当前工具
        this.classList.add('active');
        const tool = this.dataset.tool;
        document.getElementById(tool + 'Tool').style.display = 'block';
    });
});

// 文本生成表单提交
document.getElementById('textGenerationForm').addEventListener('submit', function(e) {
    e.preventDefault();
    generateContent('text', {
        prompt: document.getElementById('textPrompt').value,
        type: document.getElementById('textType').value,
        length: document.getElementById('textLength').value,
        tone: document.getElementById('textTone').value,
        keywords: document.getElementById('textKeywords').value
    });
});

// 图片生成表单提交
document.getElementById('imageGenerationForm').addEventListener('submit', function(e) {
    e.preventDefault();
    generateContent('image', {
        prompt: document.getElementById('imagePrompt').value,
        style: document.getElementById('imageStyle').value,
        size: document.getElementById('imageSize').value,
        quality: document.getElementById('imageQuality').value
    });
});

// 视频生成表单提交
document.getElementById('videoGenerationForm').addEventListener('submit', function(e) {
    e.preventDefault();
    generateContent('video', {
        prompt: document.getElementById('videoPrompt').value,
        duration: document.getElementById('videoDuration').value,
        resolution: document.getElementById('videoResolution').value
    });
});

// 音频生成表单提交
document.getElementById('audioGenerationForm').addEventListener('submit', function(e) {
    e.preventDefault();
    generateContent('audio', {
        text: document.getElementById('audioText').value,
        language: document.getElementById('audioLanguage').value,
        voice: document.getElementById('audioVoice').value,
        speed: document.getElementById('audioSpeed').value
    });
});

// 代码生成表单提交
document.getElementById('codeGenerationForm').addEventListener('submit', function(e) {
    e.preventDefault();
    generateContent('code', {
        prompt: document.getElementById('codePrompt').value,
        language: document.getElementById('codeLanguage').value,
        framework: document.getElementById('codeFramework').value
    });
});

// 通用内容生成函数
function generateContent(type, data) {
    const submitBtn = document.querySelector(`#${type}GenerationForm button[type="submit"]`);
    const originalText = submitBtn.innerHTML;
    
    submitBtn.innerHTML = '<i data-feather="loader"></i> 生成中...';
    submitBtn.disabled = true;
    
    // 显示结果区域
    document.getElementById('generationResults').style.display = 'block';
    document.getElementById('resultContent').innerHTML = `
        <div class="text-center py-4">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">生成中...</span>
            </div>
            <p class="mt-2 text-muted">AI正在生成您的内容，请稍候...</p>
        </div>
    `;
    
    // 滚动到结果区域
    document.getElementById('generationResults').scrollIntoView({ behavior: 'smooth' });
    
    fetch('/api/generate-content', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            type: type,
            prompt: data.prompt || data.text,
            ...data
        })
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            displayGenerationResult(result.generation);
            showAlert('内容生成成功！', 'success');
            
            // 刷新页面以显示新的历史记录
            setTimeout(() => {
                location.reload();
            }, 2000);
        } else {
            showAlert('生成失败，请重试', 'error');
        }
    })
    .catch(error => {
        showAlert('发生错误：' + error.message, 'error');
    })
    .finally(() => {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
        feather.replace();
    });
}

// 显示生成结果
function displayGenerationResult(generation) {
    let resultHtml = '';
    
    switch (generation.type) {
        case 'text':
            resultHtml = `
                <div class="border rounded p-3" style="background: rgba(22, 93, 255, 0.05);">
                    <h6>生成的文本内容</h6>
                    <div class="text-content">${generation.result.replace(/\n/g, '<br>')}</div>
                </div>
            `;
            break;
        case 'image':
            resultHtml = `
                <div class="text-center">
                    <h6>生成的图片</h6>
                    <img src="${generation.result}" class="img-fluid rounded" style="max-height: 400px;" alt="AI生成的图片">
                    <div class="mt-2">
                        <a href="${generation.result}" class="btn btn-sm btn-outline-primary" download>
                            <i data-feather="download"></i> 下载图片
                        </a>
                    </div>
                </div>
            `;
            break;
        case 'video':
            resultHtml = `
                <div class="text-center">
                    <h6>视频生成请求已提交</h6>
                    <p class="text-muted">视频正在生成中，完成后将通知您。</p>
                    <div class="alert alert-info">
                        <i data-feather="info"></i>
                        请求ID: ${generation.id}
                    </div>
                </div>
            `;
            break;
        case 'audio':
            resultHtml = `
                <div class="text-center">
                    <h6>生成的音频</h6>
                    <div class="mb-3">
                        <audio controls class="w-100">
                            <source src="data:audio/mp3;base64,..." type="audio/mpeg">
                            您的浏览器不支持音频播放。
                        </audio>
                    </div>
                    <button class="btn btn-sm btn-outline-primary">
                        <i data-feather="download"></i> 下载音频
                    </button>
                </div>
            `;
            break;
        case 'code':
            resultHtml = `
                <div>
                    <h6>生成的代码</h6>
                    <pre class="bg-dark text-light p-3 rounded"><code>${generation.result}</code></pre>
                </div>
            `;
            break;
    }
    
    document.getElementById('resultContent').innerHTML = resultHtml;
}

// 查看生成详情
function viewGeneration(id) {
    const modal = new bootstrap.Modal(document.getElementById('generationModal'));
    document.getElementById('generationModalContent').innerHTML = `
        <div class="text-center py-4">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="mt-2">加载中...</p>
        </div>
    `;
    modal.show();
    
    // 模拟加载详情
    setTimeout(() => {
        document.getElementById('generationModalContent').innerHTML = `
            <div class="row">
                <div class="col-md-6 mb-3">
                    <h6>生成信息</h6>
                    <div class="list-group list-group-flush">
                        <div class="list-group-item d-flex justify-content-between" style="background: transparent;">
                            <span>类型</span>
                            <span>文本</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between" style="background: transparent;">
                            <span>状态</span>
                            <span class="badge bg-success">已完成</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between" style="background: transparent;">
                            <span>生成时间</span>
                            <span>2分钟</span>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 mb-3">
                    <h6>使用统计</h6>
                    <div class="list-group list-group-flush">
                        <div class="list-group-item d-flex justify-content-between" style="background: transparent;">
                            <span>Token使用</span>
                            <span>1,250</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between" style="background: transparent;">
                            <span>成本</span>
                            <span>$0.02</span>
                        </div>
                        <div class="list-group-item d-flex justify-content-between" style="background: transparent;">
                            <span>模型</span>
                            <span>Qwen/QwQ-32B</span>
                        </div>
                    </div>
                </div>
            </div>
            <h6>原始提示</h6>
            <div class="p-3 rounded" style="background: rgba(22, 93, 255, 0.05);">
                <p class="mb-0">写一篇关于AI技术发展的博客文章...</p>
            </div>
        `;
        feather.replace();
    }, 1000);
}

// 使用生成结果
function useGeneration(id) {
    showAlert('内容已复制到剪贴板', 'success');
}

// 复制结果
document.getElementById('copyResult').addEventListener('click', function() {
    const content = document.getElementById('resultContent').innerText;
    navigator.clipboard.writeText(content).then(() => {
        showAlert('内容已复制到剪贴板', 'success');
    });
});

// 保存结果
document.getElementById('saveResult').addEventListener('click', function() {
    showAlert('结果已保存到历史记录', 'success');
});

// 重新生成
document.getElementById('regenerate').addEventListener('click', function() {
    showAlert('重新生成功能即将推出', 'info');
});

// 显示提示信息
function showAlert(message, type) {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
    alertDiv.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    const container = document.querySelector('.container-fluid');
    container.insertBefore(alertDiv, container.firstChild);
    
    setTimeout(() => {
        alertDiv.remove();
    }, 5000);
}

// 初始化
document.addEventListener('DOMContentLoaded', function() {
    feather.replace();
});
</script>
{% endblock %}